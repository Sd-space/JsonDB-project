<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Enrollment Form</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>
<body>
<div class="container">
    <h2>Student Enrollment Form</h2>
    <form id="studentForm">
        <div class="form-group">
            <label for="rollNo">Roll No:</label>
            <input type="text" class="form-control" id="rollNo" placeholder="Enter Roll No" name="rollNo" required>
        </div>
        <div class="form-group">
            <label for="fullName">Full Name:</label>
            <input type="text" class="form-control" id="fullName" placeholder="Enter Full Name" name="fullName" disabled>
        </div>
        <div class="form-group">
            <label for="class">Class:</label>
            <input type="text" class="form-control" id="class" placeholder="Enter Class" name="class" disabled>
        </div>
        <div class="form-group">
            <label for="birthDate">Birth Date:</label>
            <input type="date" class="form-control" id="birthDate" name="birthDate" disabled>
        </div>
        <div class="form-group">
            <label for="address">Address:</label>
            <input type="text" class="form-control" id="address" placeholder="Enter Address" name="address" disabled>
        </div>
        <div class="form-group">
            <label for="enrollmentDate">Enrollment Date:</label>
            <input type="date" class="form-control" id="enrollmentDate" name="enrollmentDate" disabled>
        </div>
        <button type="button" class="btn btn-primary" id="saveBtn" disabled>Save</button>
        <button type="button" class="btn btn-warning" id="updateBtn" disabled>Update</button>
        <button type="button" class="btn btn-secondary" id="resetBtn">Reset</button>
    </form>
</div>

<script>
$(document).ready(function () {
    $("#rollNo").focus();

    // Function to check if Roll No exists in the database (simulate with a placeholder function)
    function checkRollNo(rollNo) {
        // Replace this function with actual API call to check if Roll No exists in the database
        // Example response: true if exists, false if not
        return (rollNo === "123"); // Simulate Roll No "123" exists
    }

    // Function to get student data for existing Roll No (simulate with a placeholder function)
    function getStudentData(rollNo) {
        // Replace this function with actual API call to get data from the database
        return {
            rollNo: rollNo,
            fullName: "John Doe",
            class: "10",
            birthDate: "2005-01-01",
            address: "123 Street, City",
            enrollmentDate: "2020-06-15"
        };
    }

    // Reset the form
    $("#resetBtn").click(function () {
        resetForm();
    });

    // On Roll No input
    $("#rollNo").on("input", function () {
        var rollNo = $(this).val().trim();
        if (rollNo !== "") {
            var exists = checkRollNo(rollNo);
            if (exists) {
                // Roll No exists, populate form and enable update/reset buttons
                var studentData = getStudentData(rollNo);
                $("#fullName").val(studentData.fullName).prop("disabled", false);
                $("#class").val(studentData.class).prop("disabled", false);
                $("#birthDate").val(studentData.birthDate).prop("disabled", false);
                $("#address").val(studentData.address).prop("disabled", false);
                $("#enrollmentDate").val(studentData.enrollmentDate).prop("disabled", false);
                
                // Disable Save button and enable Update and Reset buttons
                $("#saveBtn").prop("disabled", true);
                $("#updateBtn").prop("disabled", false);
                $("#rollNo").prop("disabled", true);
            } else {
                // Roll No doesn't exist, enable data input and save/reset buttons
                $("#fullName, #class, #birthDate, #address, #enrollmentDate").prop("disabled", false);
                $("#saveBtn").prop("disabled", false);
                $("#updateBtn").prop("disabled", true);
                $("#rollNo").prop("disabled", false);
            }
        }
    });

    // Save button action (for new entries)
    $("#saveBtn").click(function () {
        var jsonStr = validateAndGetFormData();
        if (jsonStr !== "") {
            var putReqStr = createPUTRequest("YOUR_TOKEN_HERE", jsonStr, "SCHOOL-DB", "STUDENT-TABLE");
            executeCommand(putReqStr, "http://api.login2explore.com:5577", "/api/iml");
        }
    });

    // Update button action (for existing entries)
    $("#updateBtn").click(function () {
        var jsonStr = validateAndGetFormData();
        if (jsonStr !== "") {
            var putReqStr = createPUTRequest("YOUR_TOKEN_HERE", jsonStr, "SCHOOL-DB", "STUDENT-TABLE");
            executeCommand(putReqStr, "http://api.login2explore.com:5577", "/api/iml");
        }
    });

    // Validate form data and return JSON string
    function validateAndGetFormData() {
        var rollNoVar = $("#rollNo").val().trim();
        if (rollNoVar === "") {
            alert("Roll No is required");
            $("#rollNo").focus();
            return "";
        }
        var fullNameVar = $("#fullName").val().trim();
        if (fullNameVar === "") {
            alert("Full Name is required");
            $("#fullName").focus();
            return "";
        }
        var classVar = $("#class").val().trim();
        if (classVar === "") {
            alert("Class is required");
            $("#class").focus();
            return "";
        }
        var birthDateVar = $("#birthDate").val().trim();
        if (birthDateVar === "") {
            alert("Birth Date is required");
            $("#birthDate").focus();
            return "";
        }
        var addressVar = $("#address").val().trim();
        if (addressVar === "") {
            alert("Address is required");
            $("#address").focus();
            return "";
        }
        var enrollmentDateVar = $("#enrollmentDate").val().trim();
        if (enrollmentDateVar === "") {
            alert("Enrollment Date is required");
            $("#enrollmentDate").focus();
            return "";
        }
        var jsonStrObj = {
            rollNo: rollNoVar,
            fullName: fullNameVar,
            class: classVar,
            birthDate: birthDateVar,
            address: addressVar,
            enrollmentDate: enrollmentDateVar
        };
        return JSON.stringify(jsonStrObj);
    }

    // Function to create PUT request
    function createPUTRequest(connToken, jsonObj, dbName, relName) {
        var putRequest = "{\n"
            + "\"token\" : \"" + connToken + "\",\n"
            + "\"dbName\": \"" + dbName + "\",\n"
            + "\"cmd\" : \"PUT\",\n"
            + "\"rel\" : \"" + relName + "\",\n"
            + "\"jsonStr\": \n" + jsonObj + "\n"
            + "}";
        return putRequest;
    }

    // Function to execute PUT request
    function executeCommand(reqString, dbBaseUrl, apiEndPointUrl) {
        var url = dbBaseUrl + apiEndPointUrl;
        $.post(url, reqString, function (result) {
            alert("Operation Successful: " + JSON.stringify(result));
            resetForm(); // Reset form after operation
        }).fail(function (result) {
            alert("Operation Failed: " + result.responseText);
        });
    }

    // Reset form function
    function resetForm() {
        $("#studentForm")[0].reset();
        $("#rollNo").prop("disabled", false);
        $("#fullName, #class, #birthDate, #address, #enrollmentDate").prop("disabled", true);
        $("#saveBtn, #updateBtn").prop("disabled", true);
        $("#rollNo").focus();
    }
});
</script>
</body>
</html>
